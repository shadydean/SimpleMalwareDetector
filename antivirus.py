import tkinter as tk
from tkinter import filedialog, messagebox
import os
import json

class AntivirusApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Basic Antivirus")
        
        self.label = tk.Label(root, text="Select a directory to scan:")
        self.label.pack(pady=10)
        
        self.scan_button = tk.Button(root, text="Browse", command=self.browse_directory)
        self.scan_button.pack(pady=10)
        
        self.result_text = tk.Text(root, height=15, width=50)
        self.result_text.pack(pady=10)
        
        self.signatures = self.load_signatures('malware_signatures.json')
        
    def load_signatures(self, file_path):
        """Loads malware signatures from a JSON file."""
        try:
            with open(file_path, 'r') as f:
                return json.load(f)
        except FileNotFoundError:
            messagebox.showerror("Error", f"Signature file not found: {file_path}")
            return []

    def browse_directory(self):
        """Allows the user to browse and select a directory."""
        directory = filedialog.askdirectory()
        if directory:
            self.scan_directory(directory)
            
    def scan_file(self, file_path):
        """Scans an individual file for known malware signatures."""
        try:
            with open(file_path, 'rb') as f:
                file_content = f.read()
                for signature in self.signatures:
                    if signature['signature'].encode() in file_content:
                        return signature['name']
        except Exception as e:
            messagebox.showerror("Error", f"Failed to scan {file_path}: {e}")
        return None

    def scan_directory(self, directory):
        """Scans all files in a directory for malware."""
        infected_files = []
        for root, _, files in os.walk(directory):
            for file in files:
                file_path = os.path.join(root, file)
                result = self.scan_file(file_path)
                if result:
                    infected_files.append((file_path, result))
        self.display_results(infected_files)
        
    def display_results(self, infected_files):
        """Displays the scan results in the text area."""
        self.result_text.delete('1.0', tk.END)
        if infected_files:
            self.result_text.insert(tk.END, "Infected files found:\n")
            for file_path, malware_name in infected_files:
                self.result_text.insert(tk.END, f"{file_path} - {malware_name}\n")
        else:
            self.result_text.insert(tk.END, "No malware detected.")

if __name__ == "__main__":
    root = tk.Tk()
    app = AntivirusApp(root)
    root.mainloop()
